<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phi·∫øu Thu Chi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            background: #e0e0e0; /* N·ªÅn x√°m ƒë·ªÉ d·ªÖ nh√¨n th·∫•y khung gi·∫•y */
            padding: 40px 0; /* Kho·∫£ng c√°ch nh√¨n t·ªïng quan */
        }

        /* --- THANH C√îNG C·ª§ (Kh√¥ng in) --- */
        .no-print {
            margin-bottom: 20px;
            text-align: center;
            background: white;
            padding: 10px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .no-print button {
            padding: 10px 20px;
            margin: 0 10px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: #4CAF50;
            color: white;
            font-weight: bold;
        }

        .no-print button:hover {
            background: #45a049;
        }

        .no-print button:nth-child(2) {
            background: #2196F3;
        }

        .no-print button:nth-child(2):hover {
            background: #0b7dda;
        }
        /* -------------------------------- */

        /* --- KH·ªûI T·∫†O KH·ªûNG GI·∫§Y A4 --- */
        .phieu-container {
            background: white;
            width: 210mm; /* Chi·ªÅu r·ªông A4 */
            min-height: 297mm; /* Chi·ªÅu cao A4 */
            margin: 20px auto; /* CƒÉn gi·ªØa trang m√†n h√¨nh */
            
            /* L·ªÅ gi·∫•y theo y√™u c·∫ßu: Tr√™n 2cm, D∆∞·ªõi 2cm, Tr√°i 2.5cm, Ph·∫£i 2cm */
            padding: 2cm 2cm 2cm 2.5cm; 
            
            box-shadow: 0 0 15px rgba(0,0,0,0.3); /* ƒê·ªï b√≥ng ƒë·ªÉ th·∫•y r√µ khung gi·∫•y */
            position: relative;
        }

        .header {
            margin-bottom: 15px; /* Gi·∫£m b·ªõt kho·∫£ng tr·ªëng */
            text-align: left;
        }

        .header-content {
            display: inline-block;
            text-align: center;
        }

        .header-left {
            font-size: 13px;
            line-height: 1.3;
        }

        .header-left div {
            margin: 2px 0;
        }

        .header-left div:nth-child(3) {
            font-weight: bold;
        }

        .header-left div:nth-child(4) {
            font-weight: bold;
            text-decoration: underline;
        }

        .so-phieu {
            text-align: center;
            font-size: 13px;
            margin: 5px 0 0 0;
        }

        .title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 15px 0 5px 0; 
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .date {
            text-align: center;
            font-style: italic;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .content {
            font-size: 14px;
            line-height: 1.4;
            margin: 10px 0;
        }

        .content > div {
            margin: 5px 0;
        }

        .bang-chu {
            margin: 10px 0;
            font-style: italic;
        }

        .signatures {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 40px; /* Gi·∫£m ch√∫t kho·∫£ng c√°ch tr√™n ph·∫ßn ch·ªØ k√Ω cho v·ª´a trang */
            text-align: center;
            align-items: start;
        }

        .signature-box {
            display: flex;
            flex-direction: column;
        }

        .signature-location {
            font-style: italic;
            font-size: 14px;
            margin-bottom: 5px;
            text-align: center;
            min-height: 20px;
            line-height: 1.4;
            white-space: nowrap;
        }

        .signature-title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 90px; /* Kho·∫£ng c√°ch k√Ω */
        }

        .signature-name {
            font-weight: bold;
            font-size: 14px;
            margin-top: 15px;
            margin-bottom: 0px; /* X√≥a kho·∫£ng c√°ch d∆∞ th·ª´a d∆∞·ªõi c√πng */
        }

        /* CƒÉn ch·ªânh c·ªôt K·∫ø to√°n */
        .signature-box:nth-child(2) .signature-location {
            height: 25px;
        }

        /* --- C·∫§U H√åNH KHI IN --- */
        @media print {
            body {
                background: white;
                padding: 0;
            }

            .no-print {
                display: none !important;
            }

            .phieu-container {
                box-shadow: none;
                margin: 0;
                width: 210mm;
                min-height: 297mm;
                padding: 0; /* L·∫•y padding m·∫∑c ƒë·ªãnh c·ªßa tr√¨nh duy·ªát */
                /* Vi·ªÅn in nh·∫π (n·∫øu mu·ªën) ho·∫∑c b·ªè border */
                border: none; 
            }

            @page {
                size: A4;
                /* L·ªÅ in khi ·∫•n Ctrl+P */
                margin: 2cm 2cm 2cm 2.5cm; 
            }
        }
    </style>
</head>
<body>
    <div class="no-print">
        <button onclick="window.print()">üñ®Ô∏è In (Khuy√™n d√πng)</button>
        <button onclick="exportPDF()">üìÑ Xu·∫•t PDF</button>
    </div>

    <div class="phieu-container" id="phieu">
        <div class="header">
            <div class="header-content">
                <div class="header-left">
                    <div>CƒêCS C√îNG TY TNHH MTV</div>
                    <div>KHAI TH√ÅC CTTL NINH THU·∫¨N</div>
                    <div>C√îNG ƒêO√ÄN B·ªò PH·∫¨N</div>
                    <div>TR·∫†M TH·ª¶Y N√îNG NINH H·∫¢I</div>
                </div>
                <div class="so-phieu">S·ªë: <span id="soPhieu"></span></div>
            </div>
        </div>

        <div class="title" id="loaiPhieu">PHI·∫æU CHI</div>
        <div class="date" id="ngayPhieu"></div>

        <div class="content">
            <div>- H·ªç v√† t√™n ng∆∞·ªùi nh·∫≠n ti·ªÅn: <span id="nguoiNhan"></span></div>
            <div>- Hi·ªán ƒëang c√¥ng t√°c t·∫°i: <span id="congTac"></span></div>
            <div>- L√Ω do chi: <span id="lyDo"></span></div>
            <div>- S·ªë ti·ªÅn: <span id="soTien"></span></div>
            <div class="bang-chu">- B·∫±ng ch·ªØ: <span id="bangChu"></span></div>
        </div>

        <div class="signatures">
            <div class="signature-box">
                <div class="signature-location"></div>
                <div class="signature-title">TM. BCH CƒêBP</div>
                <div class="signature-name" id="chuTich"></div>
            </div>

            <div class="signature-box">
                <div class="signature-location"></div>
                <div class="signature-title">K·∫ø to√°n</div>
                <div class="signature-name" id="keToan"></div>
            </div>

            <div class="signature-box">
                <div class="signature-location" id="diaDiem"></div>
                <div class="signature-title">Ng∆∞·ªùi nh·∫≠n ti·ªÅn</div>
                <div class="signature-name" id="nguoiNhanTien"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        function docSo(num) {
            if (num == 0) return "Kh√¥ng";
            const ones = ["", "m·ªôt", "hai", "ba", "b·ªën", "nƒÉm", "s√°u", "b·∫£y", "t√°m", "ch√≠n"];
            const teens = ["m∆∞·ªùi", "m∆∞·ªùi m·ªôt", "m∆∞·ªùi hai", "m∆∞·ªùi ba", "m∆∞·ªùi b·ªën", "m∆∞·ªùi lƒÉm", 
                          "m∆∞·ªùi s√°u", "m∆∞·ªùi b·∫£y", "m∆∞·ªùi t√°m", "m∆∞·ªùi ch√≠n"];
            if (num < 10) return ones[num];
            if (num < 20) return teens[num - 10];
            if (num < 100) {
                const ten = Math.floor(num / 10);
                const one = num % 10;
                return ones[ten] + " m∆∞∆°i" + (one === 5 ? " lƒÉm" : (one > 0 ? " " + ones[one] : ""));
            }
            if (num < 1000) {
                const hundred = Math.floor(num / 100);
                const rest = num % 100;
                return ones[hundred] + " trƒÉm" + (rest > 0 ? " " + docSo(rest) : "");
            }
            if (num < 1000000) {
                const thousand = Math.floor(num / 1000);
                const rest = num % 1000;
                return docSo(thousand) + " ngh√¨n" + (rest > 0 ? " " + docSo(rest) : "");
            }
            if (num < 1000000000) {
                const million = Math.floor(num / 1000006);
                return docSo(million) + " tri·ªáu" + (rest > 0 ? " " + docSo(rest) : "");
            }
            return "S·ªë qu√° l·ªõn";
        }

        function soThanhChu(num) {
            const result = docSo(num);
            return result.charAt(0).toUpperCase() + result.slice(1) + " ƒë·ªìng./.";
        }

        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const soPhieu = params.get('soPhieu') || '01-2026/PC';
            const loaiPhieu = params.get('loaiPhieu') || 'PHI·∫æU CHI';
            const ngay = params.get('ngay') || '01';
            const thang = params.get('thang') || '01';
            const nam = params.get('nam') || '2026';
            const nguoiNhan = params.get('nguoiNhan') || 'Nguy·ªÖn Th·ªã V√¢n Anh';
            const congTac = params.get('congTac') || 'C·ª•m v√πng 4';
            const lyDo = params.get('lyDo') || 'Test In phi·∫øu chi';
            const soTien = params.get('soTien') || '500000';
            const chuTich = params.get('chuTich') || 'Nguy·ªÖn Ng·ªçc Thu·∫≠n';
            const keToan = params.get('keToan') || 'Nguy·ªÖn Th·ªã V√¢n Anh';
            const nguoiNhanTien = params.get('nguoiNhanTien') || 'Nguy·ªÖn Th·ªã V√¢n Anh';
            const diaDiem = params.get('diaDiem') || 'Kh√°nh H√≤a';
            
            return {
                soPhieu, loaiPhieu,
                ngayFull: `Ng√†y ${ngay} th√°ng ${thang} nƒÉm ${nam}`,
                nguoiNhan, congTac, lyDo, soTien,
                chuTich, keToan, nguoiNhanTien,
                diaDiemFull: `${diaDiem}, Ng√†y ${ngay} th√°ng ${thang} nƒÉm ${nam}`
            };
        }

        function populateForm() {
            const data = getUrlParams();
            document.getElementById('soPhieu').textContent = data.soPhieu;
            document.getElementById('loaiPhieu').textContent = data.loaiPhieu;
            document.getElementById('ngayPhieu').textContent = data.ngayFull;
            document.getElementById('nguoiNhan').textContent = data.nguoiNhan;
            document.getElementById('congTac').textContent = data.congTac;
            document.getElementById('lyDo').textContent = data.lyDo;
            document.getElementById('soTien').textContent = parseInt(data.soTien).toLocaleString('vi-VN') + ' ƒë';
            document.getElementById('bangChu').textContent = soThanhChu(parseInt(data.soTien));
            document.getElementById('chuTich').textContent = data.chuTich;
            document.getElementById('keToan').textContent = data.keToan;
            document.getElementById('nguoiNhanTien').textContent = data.nguoiNhanTien;
            document.getElementById('diaDiem').textContent = data.diaDiemFull;
        }

        function exportPDF() {
            const element = document.getElementById('phieu');
            const params = getUrlParams();
            
            // T·ªëi ∆∞u h√≥a c·∫•u h√¨nh xu·∫•t PDF
            const opt = {
                margin:       0, // ƒê·ªÉ 0 v√¨ ƒë√£ set padding trong CSS
                filename:     'phieu-thu-chi-' + params.soPhieu.replace('/', '-') + '.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { 
                    scale: 2, 
                    useCORS: true, 
                    logging: false,
                    // Quan tr·ªçng: Gi·ªØ nguy√™n trang, kh√¥ng t·ª± ƒë·ªông ng·∫Øt d√≤ng x·∫•u
                    pagebreak: { mode: ['avoid-all', 'css', 'legacy'] } 
                },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(element).save();
        }

        window.onload = populateForm;
    </script>
</body>
</html>
