<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phi·∫øu Thu Chi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            background: #e0e0e0;
            padding: 40px 0;
        }

        /* --- THANH C√îNG C·ª§ --- */
        .no-print {
            margin-bottom: 20px;
            text-align: center;
            background: white;
            padding: 10px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .no-print button {
            padding: 10px 20px;
            margin: 0 10px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: #4CAF50;
            color: white;
            font-weight: bold;
        }

        .no-print button:hover {
            background: #45a049;
        }

        .no-print button:nth-child(2) {
            background: #2196F3;
        }

        .no-print button:nth-child(2):hover {
            background: #0b7dda;
        }

        /* --- KH·ªûI T·∫†O KH·ªûNG GI·∫§Y A4 --- */
        .phieu-container {
            background: white;
            width: 210mm;
            min-height: 297mm;
            margin: 20px auto;
            padding: 2cm 2cm 2cm 2.5cm;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            position: relative;
        }

        .header {
            margin-bottom: 15px;
            text-align: left;
        }

        .header-content {
            display: inline-block;
            text-align: center;
        }

        .header-left {
            font-size: 13px;
            line-height: 1.3;
        }

        .header-left div {
            margin: 2px 0;
        }

        .header-left div:nth-child(3) {
            font-weight: bold;
        }

        .header-left div:nth-child(4) {
            font-weight: bold;
            text-decoration: underline;
        }

        .so-phieu {
            text-align: center;
            font-size: 13px;
            margin: 5px 0 0 0;
        }

        .title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 15px 0 0px 0; 
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .date {
            text-align: center;
            font-style: italic;
            font-size: 14px;
            margin-bottom: 25px;
        }

        .content {
            font-size: 14px;
            line-height: 1.4;
            margin: 10px 0;
        }

        .content > div {
            margin: 5px 0;
        }

        .bang-chu {
            margin: 10px 0;
            font-style: italic;
        }

        .signatures {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 40px;
            text-align: center;
            align-items: start;
        }

        .signature-box {
            display: flex;
            flex-direction: column;
        }

        .signature-location {
            font-style: italic;
            font-size: 14px;
            margin-bottom: 5px;
            text-align: center;
            min-height: 20px;
            line-height: 1.4;
            white-space: nowrap;
        }

        .signature-title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 90px;
        }

        .signature-name {
            font-weight: bold;
            font-size: 14px;
            margin-top: 5px;
            margin-bottom: 0px;
        }

        .signature-box:nth-child(2) .signature-location {
            height: 25px;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .no-print {
                display: none !important;
            }

            .phieu-container {
                box-shadow: none;
                margin: 0;
                width: 210mm;
                min-height: 297mm;
                padding: 0;
                border: none;
            }

            @page {
                size: A4;
                margin: 2cm 2cm 2cm 2.5cm; 
            }
        }
    </style>
</head>
<body>
    <div class="no-print">
        <button onclick="window.print()">üñ®Ô∏è In (Khuy√™n d√πng)</button>
        <button onclick="exportPDF()">üìÑ Xu·∫•t PDF</button>
    </div>

    <div class="phieu-container" id="phieu">
        <div class="header">
            <div class="header-content">
                <div class="header-left">
                    <div>CƒêCS C√îNG TY TNHH MTV</div>
                    <div>KHAI TH√ÅC CTTL NINH THU·∫¨N</div>
                    <div>C√îNG ƒêO√ÄN B·ªò PH·∫¨N</div>
                    <div>TR·∫†M TH·ª¶Y N√îNG NINH H·∫¢I</div>
                </div>
                <div class="so-phieu">S·ªë: <span id="soPhieu"></span></div>
            </div>
        </div>

        <div class="title" id="loaiPhieu">PHI·∫æU CHI</div>
        <div class="date" id="ngayPhieu"></div>

        <div class="content">
            <div>- H·ªç v√† t√™n ng∆∞·ªùi nh·∫≠n ti·ªÅn: <span id="nguoiNhan"></span></div>
            <div>- Hi·ªán ƒëang c√¥ng t√°c t·∫°i: <span id="congTac"></span></div>
            <div>- L√Ω do chi: <span id="lyDo"></span></div>
            <div>- S·ªë ti·ªÅn: <span id="soTien"></span></div>
            <div class="bang-chu">- B·∫±ng ch·ªØ: <span id="bangChu"></span></div>
        </div>

        <div class="signatures">
            <div class="signature-box">
                <div class="signature-location"></div>
                <div class="signature-title">TM. BCH CƒêBP</div>
                <div class="signature-name" id="chuTich"></div>
            </div>

            <div class="signature-box">
                <div class="signature-location"></div>
                <div class="signature-title">K·∫ø to√°n</div>
                <div class="signature-name" id="keToan"></div>
            </div>

            <div class="signature-box">
                <div class="signature-location" id="diaDiem"></div>
                <div class="signature-title">Ng∆∞·ªùi nh·∫≠n ti·ªÅn</div>
                <div class="signature-name" id="nguoiNhanTien"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        // --- H√ÄM ƒê·ªåC S·ªê TH√ÄNH CH·ªÆ ---
        function docSo(num) {
            if (num === 0) return "kh√¥ng";
            
            const chuDonVi = ["", "m·ªôt", "hai", "ba", "b·ªën", "nƒÉm", "s√°u", "b·∫£y", "t√°m", "ch√≠n"];
            const chuDonViNgan = ["", "m·ªët", "hai", "ba", "b·ªën", "lƒÉm", "s√°u", "b·∫£y", "t√°m", "ch√≠n"];
            
            function docNhom3(so, dayDu) {
                let tram = Math.floor(so / 100);
                let chuc = Math.floor((so % 100) / 10);
                let donvi = so % 10;
                let str = "";

                if (dayDu || tram > 0) {
                    str = (tram > 0 ? chuDonVi[tram] + " trƒÉm" : "") + (dayDu && tram === 0 && (chuc > 0 || donvi > 0) ? " kh√¥ng trƒÉm" : "");
                }
                
                if (chuc > 0) {
                    if (chuc === 1) {
                        str += " m∆∞·ªùi";
                        if (donvi === 1) str += " m·ªôt";
                    } else {
                        str += " " + chuDonVi[chuc] + " m∆∞∆°i";
                        if (donvi === 5) str += " nƒÉm";
                        else if (donvi > 0) str += " " + chuDonVi[donvi];
                    }
                } else if (donvi > 0) {
                    str += (tram > 0 ? " l·∫ª" : "") + " " + chuDonVi[donvi];
                }

                
                return str.trim();
            }

            if (num === 0) return "ƒë·ªìng";

            let hang = ["", "ngh√¨n", "tri·ªáu", "t·ª∑", "ngh√¨n t·ª∑", "tri·ªáu t·ª∑"];
            let i = 0;
            let str = "";
            
            while (num > 0) {
                let nhom3 = num % 1000;
                if (nhom3 > 0) {
                    let dayDu = (i === 0); 
                    str = docNhom3(nhom3, dayDu) + (hang[i] ? " " + hang[i] : "") + " " + str;
                } else if (i === 0) {
                    str = "kh√¥ng" + " " + str;
                } else if (num > 1000) {
                }
                num = Math.floor(num / 1000);
                i++;
            }
            
            return str.trim();
        }

        function soThanhChu(num) {
            const result = docSo(parseInt(num));
            return result.charAt(0).toUpperCase() + result.slice(1) + " ƒë·ªìng./.";
        }
        // ----------------------------------

        function populateForm() {
            const params = new URLSearchParams(window.location.search);
            
            const soPhieu = params.get('soPhieu') || '01-2026/PC';
            const loaiPhieu = params.get('loaiPhieu') || 'PHI·∫æU CHI';
            const ngay = params.get('ngay') || '01';
            const thang = params.get('thang') || '01';
            const nam = params.get('nam') || '2026';
            
            const nguoiNhan = params.get('nguoiNhan') || 'Nguy·ªÖn Th·ªã V√¢n Anh';
            const congTac = params.get('congTac') || 'C·ª•m v√πng 4';
            const lyDo = params.get('lyDo') || 'Test In phi·∫øu chi';
            
            // X·ª≠ l√Ω s·ªë ti·ªÅn (x√≥a d·∫•u ch·∫•m)
            let soTienStr = params.get('soTien') || '1000000';
            let cleanSoTienStr = soTienStr.replace(/\./g, '').replace(/,/g, '.');
            let soTienNum = parseInt(cleanSoTienStr) || 0;

            const chuTich = params.get('chuTich') || 'Nguy·ªÖn Ng·ªçc Thu·∫≠n';
            const keToan = params.get('keToan') || 'Nguy·ªÖn Th·ªã V√¢n Anh';
            const nguoiNhanTien = params.get('nguoiNhanTien') || 'Nguy·ªÖn Th·ªã V√¢n Anh';
            const diaDiem = params.get('diaDiem') || 'Kh√°nh H√≤a';

            // Hi·ªÉn th·ªã
            document.getElementById('soPhieu').textContent = soPhieu;
            document.getElementById('loaiPhieu').textContent = loaiPhieu;
            document.getElementById('ngayPhieu').textContent = `Ng√†y ${ngay} th√°ng ${thang} nƒÉm ${nam}`;
            document.getElementById('nguoiNhan').textContent = nguoiNhan;
            document.getElementById('congTac').textContent = congTac;
            document.getElementById('lyDo').textContent = lyDo;
            document.getElementById('soTien').textContent = soTienNum.toLocaleString('vi-VN') + ' ƒë';
            document.getElementById('bangChu').textContent = soThanhChu(soTienNum);
            document.getElementById('chuTich').textContent = chuTich;
            document.getElementById('keToan').textContent = keToan;
            document.getElementById('nguoiNhanTien').textContent = nguoiNhanTien;
            
            // --- S·ª¨A: CH·ªÆ "ng√†y" CH·ªÆ TH∆Ø·ªúNG ---
            document.getElementById('diaDiem').textContent = `${diaDiem}, ng√†y ${ngay} th√°ng ${thang} nƒÉm ${nam}`;
            // ----------------------------------
        }

        function exportPDF() {
            const element = document.getElementById('phieu');
            const params = new URLSearchParams(window.location.search);
            
            const opt = {
                margin:       0, 
                filename:     'phieu-thu-chi-' + (params.get('soPhieu') || 'PC').replace('/', '-') + '.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { 
                    scale: 2, 
                    useCORS: true, 
                    logging: false,
                    pagebreak: { mode: ['avoid-all', 'css', 'legacy'] } 
                },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(element).save();
        }

        window.onload = populateForm;
    </script>
</body>
</html>
